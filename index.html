<!doctype html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maestro Inventarios | El Cedro</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- SheetJS (XLSX) -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script defer src="app.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">EC</div>
      <div>
        <div class="title">Maestro Inventarios</div>
        <div class="subtitle">Carga tu archivo (XLSX/CSV) y analiza por sucursal</div>
      </div>
    </div>

    <div class="actions">
      <label class="upload">
        <input id="fileInput" type="file" accept=".xlsx,.xls,.csv" />
        <span>üì§ Cargar archivo</span>
      </label>
      <button id="btnClear" class="btn secondary" disabled>Limpiar</button>
    </div>
  </header>

  <main class="container">
    <section id="status" class="card status">
      <div class="status-left">
        <div class="status-title">Estado</div>
        <div id="statusMsg" class="status-msg">Carga un archivo para comenzar.</div>
        <div id="statusMeta" class="status-meta"></div>
      </div>
      <div class="status-right">
        <div class="pill" id="pillPrivacy">‚úÖ Procesamiento local (no se sube a internet)</div>
      </div>
    </section>

    <section class="card tabs">
      <button id="tabSummary" class="tab active" disabled>Resumen General</button>
      <button id="tabDetail" class="tab" disabled>Detalle por Sucursal</button>
      <div class="tab-note">Clic para cambiar de vista</div>
    </section>

    <!-- ================== RESUMEN GENERAL ================== -->
    <section id="summaryView" class="view">
      <section class="card kpis">
        <div class="card-header">
          <h2>Foto General</h2>
          <div class="hint">Umbrales: Riesgo &lt; 15 d√≠as ‚Ä¢ Sobreinventario &gt; 60 d√≠as</div>
        </div>

        <div class="kpi-grid kpi-grid-4">
          <div class="kpi">
            <div class="kpi-label">Meses usados</div>
            <div class="kpi-value" id="gMeses">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">SKUs √∫nicos</div>
            <div class="kpi-value" id="gSkus">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Inventario total (piezas)</div>
            <div class="kpi-value" id="gInv">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Cobertura global (d√≠as)</div>
            <div class="kpi-value" id="gCobDias">‚Äî</div>
          </div>
        </div>

        <div class="kpi-grid kpi-grid-4 mt12">
          <div class="kpi">
            <div class="kpi-label">Prom. venta mensual total</div>
            <div class="kpi-value" id="gPromMes">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">% SKUs Riesgo (&lt;15 d√≠as)</div>
            <div class="kpi-value" id="gRiskPct">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">% SKUs Sobreinv (&gt;60 d√≠as)</div>
            <div class="kpi-value" id="gOverPct">‚Äî</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">Sin Mov con inventario</div>
            <div class="kpi-value" id="gSinMovInv">‚Äî</div>
          </div>
        </div>
      </section>

      <section class="grid2">
        <section class="card chart-card">
          <div class="card-header">
            <h2>Clasificaci√≥n por sucursal (100% apilado)</h2>
            <div class="hint">A / B / C / Sin Mov por porcentaje</div>
          </div>
          <div class="chart-wrap">
            <canvas id="chartStacked"></canvas>
          </div>
        </section>

        <section class="card chart-card">
          <div class="card-header">
            <h2>Riesgo & Sobreinventario por sucursal</h2>
            <div class="hint">&lt;15 d√≠as y &gt;60 d√≠as</div>
          </div>
          <div class="chart-wrap">
            <canvas id="chartRiskOver"></canvas>
          </div>
        </section>
      </section>

      <section class="card table-card">
        <div class="card-header">
          <h2>Matriz ejecutiva por sucursal</h2>
          <div class="hint">Conteo y % por clasificaci√≥n + inventario y cobertura (mediana)</div>
        </div>
        <div class="table-wrap">
          <table id="heatTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="grid2">
        <section class="card">
          <div class="card-header">
            <h2>Rankings</h2>
            <div class="hint">Basados en % SKUs (conteo) y piezas (inventario)</div>
          </div>

          <div class="rank-grid">
            <div class="rank">
              <div class="rank-title">Top Riesgo (&lt;15 d√≠as)</div>
              <ol id="rankRisk" class="rank-list"></ol>
            </div>
            <div class="rank">
              <div class="rank-title">Top Sobreinventario (&gt;60 d√≠as)</div>
              <ol id="rankOver" class="rank-list"></ol>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>Hallazgos autom√°ticos</h2>
            <div class="hint">Texto listo para direcci√≥n</div>
          </div>
          <ul id="insights" class="insights"></ul>
        </section>
      </section>
    </section>

    <!-- ================== DETALLE POR SUCURSAL ================== -->
    <section id="detailView" class="view hidden">
      <section class="grid">
        <section class="card filters">
          <div class="card-header">
            <h2>Filtros</h2>
            <div class="hint">Clic en encabezados para ordenar</div>
          </div>

          <div class="form">
            <div class="field">
              <label>Sucursal</label>
              <select id="warehouseSelect" disabled></select>
            </div>

            <div class="field">
              <label>Clasificaci√≥n</label>
              <select id="classSelect" disabled>
                <option value="ALL">Todas</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="Sin Mov">Sin Mov</option>
              </select>
            </div>

            <div class="field">
              <label>B√∫squeda (C√≥digo o Descripci√≥n)</label>
              <input id="searchInput" type="text" placeholder="Ej. 750123... o BARNIZ..." disabled />
            </div>

            <div class="field">
              <label>Solo inventario &gt; 0</label>
              <label class="switch">
                <input id="onlyInvToggle" type="checkbox" disabled />
                <span class="slider"></span>
              </label>
            </div>

            <div class="field">
              <label>Rango Cobertura (D√≠as)</label>
              <div class="range">
                <input id="covMin" type="number" placeholder="M√≠n" disabled />
                <input id="covMax" type="number" placeholder="M√°x" disabled />
              </div>
              <div class="hint2">Deja vac√≠o para no filtrar</div>
            </div>

            <div class="field">
              <label>Atajos</label>
              <div class="chips">
                <label class="chip">
                  <input id="onlySinMovInv" type="checkbox" disabled />
                  <span>Sin Mov con inventario</span>
                </label>
                <label class="chip">
                  <input id="onlyABZero" type="checkbox" disabled />
                  <span>A/B con inventario 0</span>
                </label>
              </div>
            </div>

            <button id="btnExport" class="btn" disabled>‚¨áÔ∏è Exportar vista (CSV)</button>
          </div>
        </section>

        <section class="card kpis">
          <div class="card-header">
            <h2>KPIs sucursal</h2>
            <div class="hint">Recalculados con filtros</div>
          </div>

          <div class="kpi-grid kpi-grid-4">
            <div class="kpi">
              <div class="kpi-label">Meses usados</div>
              <div class="kpi-value" id="kpiMeses">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">SKUs (vista)</div>
              <div class="kpi-value" id="kpiSkus">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Inv total (piezas)</div>
              <div class="kpi-value" id="kpiInv">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Cobertura (d√≠as) mediana</div>
              <div class="kpi-value" id="kpiCobMed">‚Äî</div>
            </div>
          </div>

          <div class="kpi-grid kpi-grid-4 mt12">
            <div class="kpi">
              <div class="kpi-label">Prom. venta mes (total)</div>
              <div class="kpi-value" id="kpiProm">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">% Riesgo (&lt;15 d√≠as)</div>
              <div class="kpi-value" id="kpiRisk">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">% Sobreinv (&gt;60 d√≠as)</div>
              <div class="kpi-value" id="kpiOver">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Sin Mov con inv</div>
              <div class="kpi-value" id="kpiSinMovInv">‚Äî</div>
            </div>
          </div>

          <div class="kpi-breakdown">
            <div class="mini"><span class="dot a"></span> A: <b id="kpiA">‚Äî</b></div>
            <div class="mini"><span class="dot b"></span> B: <b id="kpiB">‚Äî</b></div>
            <div class="mini"><span class="dot c"></span> C: <b id="kpiC">‚Äî</b></div>
            <div class="mini"><span class="dot s"></span> Sin Mov: <b id="kpiS">‚Äî</b></div>
          </div>
        </section>
      </section>

      <section class="grid2">
        <section class="card chart-card">
          <div class="card-header">
            <h2>Distribuci√≥n Cobertura (d√≠as)</h2>
            <div class="hint">0‚Äì15, 16‚Äì30, 31‚Äì60, 61‚Äì120, &gt;120</div>
          </div>
          <div class="chart-wrap">
            <canvas id="chartHist"></canvas>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>Top SKUs</h2>
            <div class="hint">Sobreinventario vs Riesgo</div>
          </div>

          <div class="rank-grid">
            <div class="rank">
              <div class="rank-title">Top 15 Sobreinventario</div>
              <ol id="topOver" class="rank-list small"></ol>
            </div>
            <div class="rank">
              <div class="rank-title">Top 15 Riesgo</div>
              <ol id="topRisk" class="rank-list small"></ol>
            </div>
          </div>
        </section>
      </section>

      <section class="card table-card">
        <div class="card-header">
          <h2>Tabla</h2>
          <div class="hint" id="tableHint">‚Äî</div>
        </div>

        <div class="table-wrap">
          <table id="dataTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </section>
  </main>

  <footer class="footer">
    <div>¬© El Cedro ‚Ä¢ Web local para an√°lisis interno ‚Ä¢ No sube archivos</div>
  </footer>
</body>
</html>
